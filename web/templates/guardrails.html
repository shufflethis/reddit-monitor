{% extends "base.html" %}

{% block title %}Guardrails - Reddit Monitor{% endblock %}

{% block content %}
<div class="page-header fade-in-up">
    <h1 class="page-title"><i class="bi bi-shield-check"></i> Guardrails</h1>
    <p class="page-subtitle">Filtere Posts nach Keywords, Flairs und mehr</p>
</div>

<form method="POST" action="/settings/guardrails">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="grid grid-2 mb-4">
        <!-- Keywords -->
        <div class="card fade-in-up stagger-1">
            <div class="card-header">
                <i class="bi bi-search"></i>
                <span>Keyword Filter</span>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label">
                        <span style="color: var(--success);"><i class="bi bi-check-circle"></i></span>
                        Erforderliche Keywords
                    </label>
                    <textarea class="form-control" name="keywords" rows="4"
                              placeholder="python&#10;flask&#10;api">{{ config.keywords or '' }}</textarea>
                    <div class="form-text">Posts muessen mindestens eins enthalten</div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span style="color: var(--danger);"><i class="bi bi-x-circle"></i></span>
                        Ausgeschlossene Keywords
                    </label>
                    <textarea class="form-control" name="exclude_keywords" rows="4"
                              placeholder="spam&#10;nsfw">{{ config.exclude_keywords or '' }}</textarea>
                    <div class="form-text">Posts mit diesen werden ignoriert</div>
                </div>
            </div>
        </div>

        <!-- Flairs -->
        <div class="card fade-in-up stagger-2">
            <div class="card-header">
                <i class="bi bi-tag"></i>
                <span>Flair Filter</span>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label">
                        <span style="color: var(--success);"><i class="bi bi-check-circle"></i></span>
                        Erforderliche Flairs
                    </label>
                    <textarea class="form-control" name="required_flairs" rows="4"
                              placeholder="Discussion&#10;Question">{{ config.required_flairs or '' }}</textarea>
                    <div class="form-text">Nur Posts mit diesen Flairs (leer = alle)</div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span style="color: var(--danger);"><i class="bi bi-x-circle"></i></span>
                        Ausgeschlossene Flairs
                    </label>
                    <textarea class="form-control" name="exclude_flairs" rows="4"
                              placeholder="Meme&#10;Meta">{{ config.exclude_flairs or '' }}</textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-2 mb-4">
        <!-- Numeric Filters -->
        <div class="card fade-in-up stagger-3">
            <div class="card-header">
                <i class="bi bi-bar-chart"></i>
                <span>Numerische Filter</span>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label">Minimum Upvotes</label>
                    <input type="number" class="form-control" name="min_upvotes"
                           value="{{ config.min_upvotes or 5 }}" min="0" max="10000">
                </div>

                <div class="form-group">
                    <label class="form-label">Minimum Kommentare</label>
                    <input type="number" class="form-control" name="min_comments"
                           value="{{ config.min_comments or 0 }}" min="0" max="1000">
                </div>

                <div class="form-group">
                    <label class="form-label">Maximales Alter (Stunden)</label>
                    <input type="number" class="form-control" name="max_age_hours"
                           value="{{ config.max_age_hours or 24 }}" min="1" max="168">
                </div>
            </div>
        </div>

        <!-- Preview -->
        <div class="card fade-in-up stagger-4">
            <div class="card-header">
                <i class="bi bi-eye"></i>
                <span>Filter Vorschau</span>
            </div>
            <div class="card-body">
                <div class="terminal">
                    <div class="terminal-line"><span class="terminal-prompt">$</span> guardrails --list</div>
                    <div class="terminal-line" style="color: var(--text-muted);">
                        keywords: {{ (config.keywords or '').split('\n')|select|list|length }}
                    </div>
                    <div class="terminal-line" style="color: var(--text-muted);">
                        excluded: {{ (config.exclude_keywords or '').split('\n')|select|list|length }}
                    </div>
                    <div class="terminal-line" style="color: var(--text-muted);">
                        min_upvotes: {{ config.min_upvotes or 5 }}
                    </div>
                    <div class="terminal-line" style="color: var(--text-muted);">
                        max_age: {{ config.max_age_hours or 24 }}h
                    </div>
                </div>

                <p class="text-muted mt-3" style="font-size: 0.85rem;">
                    <i class="bi bi-info-circle"></i>
                    Posts die alle Filter passieren werden an Slack gesendet.
                </p>
            </div>
        </div>
    </div>

    <div class="flex gap-2 fade-in-up stagger-5">
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-check-lg"></i>
            Speichern
        </button>
        <a href="/" class="btn btn-secondary btn-lg">
            <i class="bi bi-arrow-left"></i>
            Zurueck
        </a>
    </div>
</form>
{% endblock %}
